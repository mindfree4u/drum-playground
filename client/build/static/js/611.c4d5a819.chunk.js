"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[611],{4611:(e,t,a)=>{a.r(t),a.d(t,{default:()=>c});var n=a(2555),o=a(9950),r=a(6559),s=a(5042),d=a(6220),l=a(4414);const c=function(){const[e,t]=(0,o.useState)([]),[a,c]=(0,o.useState)(null),[i,m]=(0,o.useState)(""),[u,p]=(0,o.useState)(!0),y=(0,r.Zp)();(0,o.useEffect)((()=>{h()}),[]);const h=async()=>{try{const e=(0,d.P)((0,d.rJ)(s.db,"payment_settings"),(0,d.My)("amount","asc")),a=(await(0,d.GG)(e)).docs.map((e=>(0,n.A)((0,n.A)({id:e.id},e.data()),{},{value:e.id})));a.push({label:"\uae08\uc561 \uc9c1\uc811\uc785\ub825",value:"custom",amount:0}),t(a),a.length>0&&c(a[0].value),p(!1)}catch(e){console.error("Error loading payment options:",e),p(!1)}},g=()=>{var t;return"custom"===a?Number(i)||0:(null===(t=e.find((e=>e.value===a)))||void 0===t?void 0:t.amount)||0},v=t=>{var o,r;const d="order_"+Date.now(),l=(null===(o=e.find((e=>e.value===a)))||void 0===o?void 0:o.label)||"\uc9c1\uc811\uc785\ub825";window.TossPayments("test_ck_GjLJoQ1aVZq1pAlkbomJ3w6KYe2R").requestPayment("\uce74\ub4dc",{amount:t,orderId:d,orderName:l,customerName:(null===(r=s.j2.currentUser)||void 0===r?void 0:r.displayName)||"\uc0ac\uc6a9\uc790",successUrl:window.location.origin+"/payment/success",failUrl:window.location.origin+"/payment-fail"}).then((function(e){console.log("Payment result:",e),b((0,n.A)((0,n.A)({},e),{},{orderId:d,paymentKey:e.paymentKey,amount:t,label:l,paymentMethod:"card"}))})).catch((function(e){console.error("Payment error:",e),"USER_CANCEL"===e.code?alert("\uacb0\uc81c\uac00 \ucde8\uc18c\ub418\uc5c8\uc2b5\ub2c8\ub2e4."):alert("\uacb0\uc81c\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.\n"+e.message)}))},b=async e=>{try{const n=s.j2.currentUser;if(!n)return void y("/login");console.log("Saving payment info:",{orderId:e.orderId,amount:e.amount,paymentMethod:e.paymentMethod,label:e.label});const o={label:e.label,amount:e.amount,paymentMethod:e.paymentMethod,timestamp:new Date,userId:n.uid,userName:n.displayName||"\uc0ac\uc6a9\uc790",orderId:e.orderId,paymentKey:e.paymentKey,status:"completed"};let r;try{r=await(0,d.gS)((0,d.rJ)(s.db,"payments"),o),console.log("Payment saved with ID:",r.id)}catch(t){console.error("Error saving payment to Firestore:",t)}await new Promise((e=>setTimeout(e,3e3)));const l="/payment/success?orderId=".concat(e.orderId,"&paymentKey=").concat(e.paymentKey,"&amount=").concat(e.amount,"&paymentSettingId=").concat(a,"&paymentMethod=").concat(e.paymentMethod);console.log("Navigating to:",l),y(l,{replace:!0})}catch(n){console.error("Error in handlePaymentSuccess:",n),alert("\uacb0\uc81c \uc815\ubcf4 \uc800\uc7a5 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4: "+n.message)}};return u?(0,l.jsx)("div",{children:"\ub85c\ub529\uc911..."}):(0,l.jsxs)("div",{className:"payment-page-container",style:{maxWidth:400,margin:"40px auto",padding:20,background:"#fff",borderRadius:8,boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:[(0,l.jsx)("h2",{children:"\uacb0\uc81c\ud558\uae30(\uc2dc\ud5d8\uc911\uc73c\ub85c\uc11c \uc9c0\uae08\uc740 \uacb0\uc81c\uac00 \uc774\ub8e8\uc5b4\uc9c0\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4)"}),(0,l.jsxs)("div",{style:{marginBottom:24},children:[e.map((e=>(0,l.jsx)("div",{style:{marginBottom:12},children:(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"radio",name:"paymentOption",value:e.value,checked:a===e.value,onChange:()=>c(e.value)}),e.label,"custom"!==e.value&&(0,l.jsxs)("span",{style:{marginLeft:8,color:"#888"},children:["(",e.amount.toLocaleString(),"\uc6d0)"]})]})},e.value))),"custom"===a&&(0,l.jsx)("div",{style:{marginTop:8},children:(0,l.jsx)("input",{type:"number",min:"3000",step:"100",placeholder:"\uae08\uc561\uc744 \uc785\ub825\ud558\uc138\uc694 (\uc6d0)",value:i,onChange:e=>m(e.target.value),style:{width:"100%",padding:8,borderRadius:4,border:"1px solid #ccc"}})})]}),(0,l.jsx)("button",{onClick:()=>{const e=g();if(!window.TossPayments){const t=document.createElement("script");return t.src="https://js.tosspayments.com/v1/payment",t.async=!0,document.body.appendChild(t),t.onload=()=>{v(e)},void(t.onerror=()=>{alert("\uacb0\uc81c \ubaa8\ub4c8\uc744 \ubd88\ub7ec\uc624\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4. \uc7a0\uc2dc \ud6c4 \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694.")})}v(e)},style:{width:"100%",padding:12,background:"#007bff",color:"#fff",border:"none",borderRadius:4,fontSize:16,cursor:"pointer"},disabled:g()<3e3,children:"\uacb0\uc81c\ud558\uae30"})]})}}}]);